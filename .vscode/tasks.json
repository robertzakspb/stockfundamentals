{
    "version": "2.0.0",
    "tasks": [
        {
            "type": "go",
            "label": "go: build package",
            "command": "build",
            "args": ["${fileDirname}"],
            "problemMatcher": ["$go"],
            "group": "build",
            "detail": "cd /Users/robert/Documents/Programming/Investing/stockfundamentals; go build ${fileDirname}"
        },
        //PRE-DEBUG TASKS THAT START DOCKER CONTAINERS AND RESTORE THE LATEST BACKUP FOR CONVENIENCE
        {
            "label": "Start_DB",
            "dependsOrder": "sequence",
            "dependsOn": ["Open_Docker", "Start_Local_DB", "Open_YDB_UI", "Restore_Latest_Backup"]
        },
        {
            "type": "shell",
            "label": "Open_Docker",
            "osx": { "command": "open -a Docker && sleep 3" },
            "linux": { "command": "" }
        },
        {
            "type": "shell",
            "label": "Start_Local_DB",
            "osx": {
                "command": "docker run -d --rm --name ydb-local -h localhost --platform linux/amd64 -p 2135:2135 -p 2136:2136 -p 8765:8765 -p 9092:9092 -v $(pwd)/ydb_certs:/ydb_certs -v $(pwd)/ydb_data:/ydb_data -e GRPC_TLS_PORT=2135 -e GRPC_PORT=2136 -e MON_PORT=8765 -e YDB_KAFKA_PROXY_PORT=9092 ydbplatform/local-ydb:latest && sleep 3"
            },
            "linux": { "command": "cd ~/ydbd && ./start.sh disk" }
        },
        {
            "type": "shell",
            "label": "Open_YDB_UI",
            "osx": { "command": "open http://localhost:8765/" },
            "linux": { "command": "setsid xdg-open http://localhost:8765/" }
        },
        {
            "type": "shell",
            "label": "Restore_Latest_Backup",
            "osx": {
                "command": "ydb -e \"grpc://localhost:2136\" -d \"/local\" tools restore -i \"/Users/robert/Documents/backups/compound/latestbackup\" -p \".\""
            },
            "linux": { "command": "" }
        },
        //POST-DEBUG TASK THAT QUITS DOCKER AND CREATES THE REQUIRED BACKUPS
        {
            "label": "Make_DB_Backup",
            "dependsOrder": "sequence",
            "dependsOn": ["Remove_Old_Latest_Backup", "Make_Backups", "Stop_DB"]
        },
        {
            "type": "shell",
            "label": "Remove_Old_Latest_Backup",
            "osx": {
                "command": "rm -rf  \"/Users/robert/Documents/backups/compound/latestbackup\" && sleep 1"
            },
            "linux": { "command": "" }
        },
        {
            "type": "shell",
            "label": "Make_Backups",
            "osx": {
                "command": "ydb -e \"grpc://localhost:2136\" -d \"/local\" tools dump -o \"/Users/robert/Documents/backups/compound/latestbackup\""
            },
            "linux": { "command": "ydb -e \"grpc://localhost:2136\" -d \"/Root/test\" tools dump -o \"/home/rob/Documents/backups/compound/$(date +%Y%m%d_%H%M%S)\"" }
        },
        {
            "type": "shell",
            "label": "Stop_DB",
            //TODO: Test and implement
            "osx": { "command": "" },
            "linux": { "command": "cd ~/ydbd && ./stop.sh" }
        }
    ]
}
